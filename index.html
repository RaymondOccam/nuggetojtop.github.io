<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>éšæœºæŠ½å–å­¦ç”Ÿ</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Microsoft YaHei', sans-serif; }
        body { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }
        .container { 
            width: 100%; 
            max-width: 800px; 
            background: rgba(255,255,255,0.95); 
            border-radius: 16px; 
            box-shadow: 0 8px 32px rgba(0,0,0,0.15); 
            padding: 30px; 
            margin: 0 auto;
        }
        h1 { 
            text-align: center; 
            color: #333; 
            margin-bottom: 25px; 
            font-size: 28px; 
            position: relative;
        }
        h1::after { 
            content: ''; 
            display: block; 
            width: 80px; 
            height: 4px; 
            background: #667eea; 
            margin: 10px auto 0; 
            border-radius: 2px;
        }
        .input-area { margin-bottom: 30px; }
        label { 
            display: block; 
            color: #555; 
            margin-bottom: 10px; 
            font-weight: 500; 
            font-size: 16px;
        }
        .textarea-wrap { position: relative; }
        textarea { 
            width: 100%; 
            height: 180px; 
            padding: 15px; 
            border: 1px solid #e0e0e0; 
            border-radius: 8px; 
            resize: none; 
            font-size: 16px; 
            line-height: 1.6; 
            outline: none;
            transition: all 0.3s;
        }
        textarea:focus { 
            border-color: #667eea; 
            box-shadow: 0 0 0 3px rgba(102,126,234,0.2); 
        }
        .save-tip { 
            position: absolute; 
            right: 15px; 
            bottom: 10px; 
            font-size: 12px; 
            color: #888;
        }
        .btn-group { 
            display: flex; 
            gap: 12px; 
            justify-content: center; 
            margin-bottom: 30px; 
            flex-wrap: wrap;
        }
        button { 
            padding: 12px 24px; 
            border: none; 
            border-radius: 8px; 
            font-size: 16px; 
            cursor: pointer; 
            transition: all 0.2s; 
            font-weight: 500;
        }
        #startBtn { background: #667eea; color: #fff; }
        #startBtn:hover { background: #5a6edb; transform: translateY(-2px); }
        #stopBtn { background: #e53e3e; color: #fff; display: none; }
        #stopBtn:hover { background: #c53030; transform: translateY(-2px); }
        .batch-btn { background: #38b2ac; color: #fff; }
        .batch-btn:hover { background: #319795; transform: translateY(-2px); }
        #resetBtn { background: #ed8936; color: #fff; }
        #resetBtn:hover { background: #dd6b20; transform: translateY(-2px); }
        .save-btn { background: #48bb78; color: #fff; }
        .save-btn:hover { background: #38a169; transform: translateY(-2px); }
        .clear-save-btn { background: #9f7aea; color: #fff; }
        .clear-save-btn:hover { background: #805ad5; transform: translateY(-2px); }
        .result-area { 
            text-align: center; 
            margin-bottom: 30px; 
            padding: 20px; 
            border-radius: 8px; 
            background: #f8f9fa;
        }
        .result-title { 
            color: #666; 
            margin-bottom: 15px; 
            font-size: 18px;
        }
        .result-box { 
            font-size: 32px; 
            font-weight: bold; 
            color: #667eea; 
            height: 60px; 
            line-height: 60px; 
            overflow: hidden;
        }
        .history-area { margin-top: 30px; }
        .history-title { 
            color: #555; 
            margin-bottom: 15px; 
            font-size: 18px; 
            display: flex; 
            align-items: center;
        }
        .history-title::before { 
            content: ''; 
            display: inline-block; 
            width: 4px; 
            height: 20px; 
            background: #667eea; 
            margin-right: 8px; 
            border-radius: 2px;
        }
        .history-list { 
            display: flex; 
            flex-wrap: wrap; 
            gap: 10px; 
            max-height: 150px; 
            overflow-y: auto; 
            padding: 10px; 
            border: 1px solid #e0e0e0; 
            border-radius: 8px; 
            background: #fff;
        }
        .history-item { 
            padding: 6px 12px; 
            background: #f0f4ff; 
            color: #667eea; 
            border-radius: 20px; 
            font-size: 14px;
        }
        /* å“åº”å¼è°ƒæ•´ */
        @media (max-width: 600px) {
            .container { padding: 20px; }
            h1 { font-size: 24px; }
            .result-box { font-size: 28px; }
            button { padding: 10px 18px; font-size: 14px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>éšæœºæŠ½å–å­¦ç”Ÿ</h1>

        <!-- å­¦ç”Ÿåå•è¾“å…¥åŒº -->
        <div class="input-area">
            <label for="studentList">è¾“å…¥å­¦ç”Ÿåå•ï¼ˆæ¯è¡Œ1äººï¼‰</label>
            <div class="textarea-wrap">
                <textarea id="studentList" placeholder="ä¾‹å¦‚ï¼š
å¼ ä¸‰
æå››
ç‹äº”
èµµå…­"></textarea>
                <span class="save-tip">ğŸ’¾ è‡ªåŠ¨ä¿å­˜ä¸­</span>
            </div>
        </div>

        <!-- åŠŸèƒ½æŒ‰é’®åŒº -->
        <div class="btn-group">
            <button id="startBtn">å¼€å§‹æŠ½å–</button>
            <button id="stopBtn">åœæ­¢æŠ½å–</button>
            <button class="batch-btn" id="batch1Btn">æŠ½å–1äºº</button>
            <button class="batch-btn" id="batch3Btn">æŠ½å–3äºº</button>
            <button class="batch-btn" id="batch5Btn">æŠ½å–5äºº</button>
            <button id="resetBtn">é‡ç½®æŠ½å–</button>
            <button class="save-btn" id="manualSaveBtn">æ‰‹åŠ¨ä¿å­˜åå•</button>
            <button class="clear-save-btn" id="clearSaveBtn">æ¸…ç©ºä¿å­˜çš„åå•</button>
        </div>

        <!-- æŠ½å–ç»“æœåŒº -->
        <div class="result-area">
            <div class="result-title">å½“å‰æŠ½å–ç»“æœ</div>
            <div class="result-box" id="resultBox">ç­‰å¾…æŠ½å–...</div>
        </div>

        <!-- å†å²è®°å½•åŒº -->
        <div class="history-area">
            <div class="history-title">å†å²æŠ½å–è®°å½•</div>
            <div class="history-list" id="historyList"></div>
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡
        const studentListEl = document.getElementById('studentList');
        const resultBoxEl = document.getElementById('resultBox');
        const historyListEl = document.getElementById('historyList');
        const startBtn = document.getElementById('startBtn');
        const stopBtn = document.getElementById('stopBtn');
        const batch1Btn = document.getElementById('batch1Btn');
        const batch3Btn = document.getElementById('batch3Btn');
        const batch5Btn = document.getElementById('batch5Btn');
        const resetBtn = document.getElementById('resetBtn');
        const manualSaveBtn = document.getElementById('manualSaveBtn');
        const clearSaveBtn = document.getElementById('clearSaveBtn');

        let isRolling = false; // æ˜¯å¦æ­£åœ¨æ»šåŠ¨æŠ½å–
        let rollInterval = null; // æ»šåŠ¨å®šæ—¶å™¨
        let studentArray = []; // å­¦ç”Ÿåå•æ•°ç»„
        let selectedStudents = []; // å·²æŠ½å–çš„å­¦ç”Ÿï¼ˆé˜²é‡å¤ï¼‰

        // 1. åˆå§‹åŒ–ï¼šåŠ è½½ä¿å­˜çš„å­¦ç”Ÿåå•
        function init() {
            const savedList = localStorage.getItem('studentList');
            if (savedList) {
                studentListEl.value = savedList;
                updateStudentArray(); // åŒæ­¥åˆ°æ•°ç»„
            }

            // ç›‘å¬æ–‡æœ¬æ¡†å˜åŒ–ï¼Œè‡ªåŠ¨ä¿å­˜
            studentListEl.addEventListener('input', () => {
                localStorage.setItem('studentList', studentListEl.value);
                updateStudentArray();
            });
        }

        // 2. æ›´æ–°å­¦ç”Ÿåå•æ•°ç»„ï¼ˆå»é‡ã€è¿‡æ»¤ç©ºè¡Œï¼‰
        function updateStudentArray() {
            studentArray = studentListEl.value
                .split('\n')
                .map(name => name.trim()) // å»é™¤å‰åç©ºæ ¼
                .filter(name => name !== '') // è¿‡æ»¤ç©ºè¡Œ
                .filter((name, index, self) => self.indexOf(name) === index); // å»é‡
        }

        // 3. éšæœºæŠ½å–1åå­¦ç”Ÿï¼ˆæ”¯æŒé˜²é‡å¤ï¼‰
        function getRandomStudent() {
            // è¿‡æ»¤å·²æŠ½å–çš„å­¦ç”Ÿï¼Œå¾—åˆ°å¯é€‰åå•
            const availableStudents = studentArray.filter(name => !selectedStudents.includes(name));
            
            if (availableStudents.length === 0) {
                return 'æ‰€æœ‰å­¦ç”Ÿå·²æŠ½å–å®Œæ¯•ï¼';
            }

            const randomIndex = Math.floor(Math.random() * availableStudents.length);
            const selected = availableStudents[randomIndex];
            selectedStudents.push(selected); // åŠ å…¥å·²æŠ½å–åˆ—è¡¨
            return selected;
        }

        // 4. æ‰¹é‡æŠ½å–å­¦ç”Ÿ
        function batchSelect(count) {
            if (studentArray.length === 0) {
                resultBoxEl.textContent = 'è¯·å…ˆè¾“å…¥å­¦ç”Ÿåå•ï¼';
                return;
            }

            const results = [];
            for (let i = 0; i < count; i++) {
                const student = getRandomStudent();
                if (student === 'æ‰€æœ‰å­¦ç”Ÿå·²æŠ½å–å®Œæ¯•ï¼') {
                    results.push(student);
                    break;
                }
                results.push(student);
            }

            resultBoxEl.textContent = results.join('ã€');
            addToHistory(results.join('ã€')); // åŠ å…¥å†å²è®°å½•
        }

        // 5. å¼€å§‹æ»šåŠ¨æŠ½å–
        function startRoll() {
            if (studentArray.length === 0) {
                resultBoxEl.textContent = 'è¯·å…ˆè¾“å…¥å­¦ç”Ÿåå•ï¼';
                return;
            }

            isRolling = true;
            startBtn.style.display = 'none';
            stopBtn.style.display = 'inline-block';

            // æ¸…é™¤å·²æŠ½å–åˆ—è¡¨ï¼ˆæ»šåŠ¨æŠ½å–æ¨¡å¼ä¸é˜²é‡å¤ï¼‰
            selectedStudents = [];

            // å®šæ—¶å™¨ï¼šå¿«é€Ÿåˆ‡æ¢æ˜¾ç¤ºå­¦ç”Ÿå§“å
            rollInterval = setInterval(() => {
                const randomIndex = Math.floor(Math.random() * studentArray.length);
                resultBoxEl.textContent = studentArray[randomIndex];
            }, 50);
        }

        // 6. åœæ­¢æ»šåŠ¨æŠ½å–
        function stopRoll() {
            clearInterval(rollInterval);
            isRolling = false;
            startBtn.style.display = 'inline-block';
            stopBtn.style.display = 'none';

            const selected = getRandomStudent();
            resultBoxEl.textContent = selected;
            addToHistory(selected);
        }

        // 7. æ·»åŠ åˆ°å†å²è®°å½•
        function addToHistory(content) {
            const historyItem = document.createElement('div');
            historyItem.className = 'history-item';
            historyItem.textContent = content;
            historyListEl.prepend(historyItem); // æ–°å¢è®°å½•æ”¾åœ¨å‰é¢
        }

        // 8. é‡ç½®æŠ½å–çŠ¶æ€
        function resetSelect() {
            selectedStudents = [];
            resultBoxEl.textContent = 'ç­‰å¾…æŠ½å–...';
            historyListEl.innerHTML = '';
        }

        // 9. æ‰‹åŠ¨ä¿å­˜åå•ï¼ˆæ‰‹åŠ¨è§¦å‘ï¼Œå¤‡ä»½ç”¨ï¼‰
        function manualSave() {
            localStorage.setItem('studentList', studentListEl.value);
            updateStudentArray();
            
            // æç¤ºä¿å­˜æˆåŠŸ
            const tip = document.createElement('div');
            tip.style.position = 'fixed';
            tip.style.top = '20px';
            tip.style.left = '50%';
            tip.style.transform = 'translateX(-50%)';
            tip.style.padding = '8px 16px';
            tip.style.background = 'rgba(72,187,120,0.9)';
            tip.style.color = '#fff';
            tip.style.borderRadius = '4px';
            tip.style.fontSize = '14px';
            tip.textContent = 'åå•ä¿å­˜æˆåŠŸï¼';
            document.body.appendChild(tip);
            
            setTimeout(() => {
                document.body.removeChild(tip);
            }, 1500);
        }

        // 10. æ¸…ç©ºä¿å­˜çš„åå•
        function clearSave() {
            if (confirm('ç¡®å®šè¦æ¸…ç©ºä¿å­˜çš„å­¦ç”Ÿåå•å—ï¼Ÿï¼ˆæœ¬åœ°å°†ä¸å†ä¿ç•™ï¼‰')) {
                localStorage.removeItem('studentList');
                studentListEl.value = '';
                updateStudentArray();
                selectedStudents = [];
                resultBoxEl.textContent = 'ç­‰å¾…æŠ½å–...';
                historyListEl.innerHTML = '';
            }
        }

        // ç»‘å®šæŒ‰é’®äº‹ä»¶
        startBtn.addEventListener('click', startRoll);
        stopBtn.addEventListener('click', stopRoll);
        batch1Btn.addEventListener('click', () => batchSelect(1));
        batch3Btn.addEventListener('click', () => batchSelect(3));
        batch5Btn.addEventListener('click', () => batchSelect(5));
        resetBtn.addEventListener('click', resetSelect);
        manualSaveBtn.addEventListener('click', manualSave);
        clearSaveBtn.addEventListener('click', clearSave);

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        window.addEventListener('load', init);
    </script>
</body>
</html>
